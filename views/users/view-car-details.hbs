<div id="carouselExampleCrossfade" class="carousel slide carousel-fade" data-mdb-ride="carousel">
    {{!-- <div class="carousel-indicators">
        <button type="button" data-mdb-target="#carouselExampleCrossfade" data-mdb-slide-to="0" class="active"
            aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-mdb-target="#carouselExampleCrossfade" data-mdb-slide-to="1"
            aria-label="Slide 2"></button>
        <button type="button" data-mdb-target="#carouselExampleCrossfade" data-mdb-slide-to="2"
            aria-label="Slide 3"></button>
    </div> --}}
    <div class="carousel-inner">

        <div class="carousel-item active">

            <img src="/images/car-images/{{carsData.images.[0]}}" class="d-block w-100" alt="..." />
        </div>

        <div class="carousel-item">
            <img src="/images/car-images/{{carsData.images.[1]}}" class="d-block w-100" alt="..." />
        </div>
        <div class="carousel-item">
            <img src="/images/car-images/{{carsData.images.[2]}}" class="d-block w-100" alt="..." />
        </div>
        <div class="carousel-item">
            <img src="/images/car-images/{{carsData.images.[3]}}" class="d-block w-100" alt="..." />
        </div>



    </div>
    <button class="carousel-control-prev" type="button" data-mdb-target="#carouselExampleCrossfade"
        data-mdb-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-mdb-target="#carouselExampleCrossfade"
        data-mdb-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<section>
    <div class="container p-2 mt-3 mt-md-5">
        <div class="row d-flex justify-content-center">
            {{!-- mobile view --}}
            <div class="col-12 d-block d-md-none mb-4">
                <div class="d-md-none d-block ps-2 mb-3">
                    <p class="fs-2 fw-bold">{{carsData.brand}} {{carsData.model}} {{carsData.makeyear}}</p>
                    <h4 class="text-muted">{{carsData.varient}}</h4>
                </div>
                <div class="d-flex ps-2 pe-2 ">
                    {{#if carsData.oldPrice}}
                    <del class="fs-6 fw-bold text-muted"> ₹ {{carsData.oldPrice}}</del>
                    {{/if}}
                    <p class="fs-4 fw-bold ms-2">₹ {{carsData.price_per_day}} /day</p>

                </div>
                {{!-- mobile view form --}}
                <form action="/checkout/{{carsData._id}}" method="post" onsubmit="return checkTime('{{carsData._id}}')">
                    <div class="mt-3 ps-2 pe-2">
                        <p class="text-primary fw-bold">Trip Starts</p>
                        <div class="d-flex ">
                            <div class=" col-6">

                                <input type="date" name="from" id="from" class="form-control  border-primary"
                                    oninput="return fromDateSelect()" />
                            </div>
                            <div class="col-6">

                                <select id="from-time" name="from"  
                                    class="form-select form-select-sm ms-1 border-primary">
                                    <option value=" 09:00" selected>09:00 AM</option>
                                    <option value=" 10:00">10:00 AM</option>
                                    <option value=" 11:00">11:00 AM</option>
                                    <option value=" 12:00">12:00 PM</option>
                                    <option value=" 13:00">01:00 PM</option>
                                    <option value=" 14:00">02:00 PM</option>
                                    <option value=" 15:00">03:00 PM</option>
                                    <option value=" 16:00">04:00 PM</option>
                                    <option value=" 17:00">05:00 PM</option>
                                    <option value=" 18:00">06:00 PM</option>
                                    <option value=" 19:00">07:00 PM</option>
                                    <option value=" 20:00">08:00 PM</option>
                                    <option value=" 21:00">09:00 PM</option>
                                    <option value=" 22:00">10:00 PM</option>
                                </select>
                                <p id="time-err-msg" class="text-danger"></p>

                            </div>
                        </div>
                    </div>
                    <div class="mt-3 ps-2 pe-2">
                        <p class="text-primary fw-bold">Trip Ends</p>
                        <div class="d-flex ">
                            <div class=" col-6">

                                <input type="date" onchange="return checkCarBooked('{{carsData._id}}')"   name="to" id="to" class="form-control  border-primary" />
                            </div>
                            <div class="col-6">

                                <select id="to-time" oninput="return checkCarBooked('{{carsData._id}}')"  name="to" class="form-select form-select-sm ms-1 border-primary">
                                    <option value=" 09:00" selected>09:00 AM</option>
                                    <option value=" 10:00">10:00 AM</option>
                                    <option value=" 11:00">11:00 AM</option>
                                    <option value=" 12:00">12:00 PM</option>
                                    <option value=" 13:00">01:00 PM</option>
                                    <option value=" 14:00">02:00 PM</option>
                                    <option value=" 15:00">03:00 PM</option>
                                    <option value=" 16:00">04:00 PM</option>
                                    <option value=" 17:00">05:00 PM</option>
                                    <option value=" 18:00">06:00 PM</option>
                                    <option value=" 19:00">07:00 PM</option>
                                    <option value=" 20:00">08:00 PM</option>
                                    <option value=" 21:00">09:00 PM</option>
                                    <option value=" 22:00">10:00 PM</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3 ps-2 pe-2">
                        <p class="text-primary fw-bold">Pickup and Return Location</p>
                        <div class="d-flex">
                            <div class=" col-12">

                                <input type="text" name="location" value="{{carsData.pick_up_address.address}}"
                                    class="form-control  border-primary" readonly />
                            </div>

                        </div>
                    </div>
                    <div class="mt-3 ps-2 pe-2">

                        <p class="text-danger  d-none" id="days-msg">Select days between <b> 1 </b> to <b> 10 </b> days
                        </p>


                        <p class="text-danger" id="car-booked-msg"></p>


                        {{#if userNotVerified}}
                        <p class="text-danger">Please verify your account by uploading your licence</p>
                        <a class="text-decoration-none" href="/edit-profile">upload</a>
                        {{/if}}
                        <div class=" col-md-11 d-grid">
                            <button type="submit" class="btn btn-primary">continue</button>
                        </div>
                    </div>
                </form>
                {{!-- <div class="mt-3 ps-2 pe-2">
                    <div class=" col-md-11 d-grid">
                        <button type="submit" class="btn btn-outline-primary btn-sm rounded-1">add to
                            favourites</button>
                    </div>
                </div> --}}
            </div>

            <div class="col-11 col-md-6">
                <div class="row">
                    <div class="d-none d-md-block">
                        <p class="fs-2 fw-bold">{{carsData.brand}} {{carsData.model}} {{carsData.makeyear}}</p>
                        <h4 class="text-muted mt-2">{{carsData.type}}</h4>
                    </div>
                    <div class="d-flex align-items-end">
                        {{#if reviews.averageRating}}

                        <p class="fs-3 fw-bold mt-2">{{reviews.averageRating}} <i
                                class="fas fa-star text-primary ms-1"></i> </p>
                        <p class="ms-3 fs-6">({{reviews.noOfReviews}} ratings)</p>
                        {{else}}

                        <p class="fs-3 fw-bold mt-2">0<i class="fas fa-star text-primary ms-1"></i> </p>
                        <p class="ms-3 fs-6">(0 ratings)</p>
                        {{/if}}
                    </div>
                    <div class="row mt-3">
                        <div class="col-6 col-md-6">
                            <div class="d-flex align-items-start">

                                <img src="https://img.icons8.com/external-those-icons-fill-those-icons/16/000000/external-car-door-cars-components-those-icons-fill-those-icons-1.png"
                                    / style="object-fit: contain;">
                                <p class="fs-6 ms-3">{{carsData.no_of_doors}} Doors</p>
                            </div>
                            <div class="d-flex align-items-start mt-3">

                                <img src="https://img.icons8.com/ios-filled/18/000000/car-seat.png" /
                                    style="object-fit: contain">
                                <p class="fs-6 ms-3">{{carsData.no_of_seats}} Seats</p>
                            </div>

                        </div>
                        <div class="col-6 col-md-6">
                            <div class="d-flex">

                                <i class="fas fa-truck-monster"></i>
                                <p class="fs-6 ms-3">{{carsData.twowd_or_fourwd}}</p>
                            </div>
                            <div class="d-flex mt-3">

                                <i class="fas fa-gas-pump"></i>
                                <p class="fs-6 ms-3">{{carsData.fuel}}</p>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-10">
                        <p class="fs-5 fw-bold mt-4">Description</p>
                        <p class="mt-3 ">{{carsData.discription}}</p>
                    </div>
                    {{!-- features starts --}}
                    <div class="row mt-2">
                        <p class="fs-5 fw-bold mt-4 mb-4">Features</p>
                        {{#each carsData.features}}
                        <div class="col-6 col-md-5 d-flex align-items-start">

                            <p class="fs-6 ms-3">{{this}}</p>
                        </div>
                        {{/each}}


                    </div>
                    {{!-- features ends --}}

                    {{!-- ratings and reviews --}}
                    <div class="row mt-2">
                        <p class="fs-5 fw-bold mt-4 mb-4">Rating and Reviews</p>
                        <div class="d-flex align-items-end">
                            {{#if reviews.averageRating}}

                            <p class="fs-4 fw-bold">{{reviews.averageRating}} <i
                                    class="fas fa-star text-primary ms-1"></i> </p>
                            <p class="ms-3 fs-7">({{reviews.noOfReviews}} ratings)</p>
                            {{else}}
                            <p class="fs-6">No reviews yet</p>
                            {{/if}}
                        </div>
                        {{!-- //one riview --}}
                        {{#each reviews.users}}
                        <div class="row mt-4">
                            <div class=" col-3 col-md-2">
                                {{#if this.profileimage}}
                                <img src="/images/user-images/{{this.profileimage}}"
                                    class="d-block w-100 car-details ms-md-3" alt="..."
                                    style="width: 50px !important; height: 50px !important; object-fit: cover; border-radius: 100%;" />
                                {{else}}
                                <img src="https://icon-library.com/images/profile-image-icon/profile-image-icon-24.jpg"
                                    class="d-block w-100 car-details ms-md-3" alt="..."
                                    style="width: 50px !important; height: 50px !important; object-fit: cover; border-radius: 100%;" />
                                {{/if}}


                            </div>
                            <div class="col-9 col-md-10">
                                <div class="star-rating">
                                    <span hidden>{{this.rating}}</span>

                                    <i class="rating_star far fa-star text-primary ms-1"></i>
                                    <i class="rating_star far fa-star text-primary ms-1"></i>
                                    <i class="rating_star far fa-star text-primary ms-1"></i>
                                    <i class="rating_star far fa-star text-primary ms-1"></i>
                                    <i class="rating_star far fa-star text-primary ms-1"></i>
                                </div>
                                <div class="d-flex p-1">

                                    <p class="fs-6 fw-bold">{{this.firstname}} {{this.lastname}}</p>
                                    <p class="ms-3 text-muted">{{this.date}}</p>
                                </div>


                                <p class="ms-1">{{this.review}}</p>

                            </div>
                        </div>
                        {{/each}}
                    </div>
                    {{!-- /ratings and reviews --}}

                </div>


            </div>
            <div class="col-md-4 d-none d-md-block">    
                <div class="d-flex">

                    {{#if carsData.oldPrice}}
                    <del class="fs-6 fw-bold text-muted"> ₹ {{carsData.oldPrice}}</del>
                    {{/if}}
                    <p class="fs-4 fw-bold ms-2">₹ {{carsData.price_per_day}} /day</p>
                </div>
                {{!-- desk top view form --}}
                <form action="/checkout/{{carsData._id}}"
                    method="post" onsubmit="return checkTime1('{{carsData._id}}')">
                    <div class="mt-3">
                        <p class="text-primary fw-bold">Trip Starts</p>
                        <div class="d-flex">
                            <div class=" col-md-6">
                                <input type="date" name="from" id="from1" class="form-control  border-primary"
                                    oninput="return fromDateSelect1()" />
                            </div>
                            <div class="col-md-5">

                                <select id="from-time1" name="from"
                                    class="form-select form-select-sm ms-1 border-primary">
                                    <option value=" 09:00" selected>09:00 AM</option>
                                    <option value=" 10:00">10:00 AM</option>
                                    <option value=" 11:00">11:00 AM</option>
                                    <option value=" 12:00">12:00 PM</option>
                                    <option value=" 13:00">01:00 PM</option>
                                    <option value=" 14:00">02:00 PM</option>
                                    <option value=" 15:00">03:00 PM</option>
                                    <option value=" 16:00">04:00 PM</option>
                                    <option value=" 17:00">05:00 PM</option>
                                    <option value=" 18:00">06:00 PM</option>
                                    <option value=" 19:00">07:00 PM</option>
                                    <option value=" 20:00">08:00 PM</option>
                                    <option value=" 21:00">09:00 PM</option>
                                    <option value=" 22:00">10:00 PM</option>
                                    <option value=" 23:00">11:00 PM</option>
                                    <option value=" 24:00">12:00 PM</option>
                                </select>
                                <p id="time-err-msg1" class="text-danger"></p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <p class="text-primary fw-bold">Trip Ends</p>
                        <div class="d-flex">
                            <div class=" col-md-6">

                                <input type="date" onchange="return checkCarBooked1('{{carsData._id}}')" name="to"
                                    id="to1" class="form-control  border-primary" />
                            </div>
                            <div class="col-md-5">

                                <select id="to-time1" oninput="return checkCarBooked1('{{carsData._id}}')" name="to"
                                    class="form-select form-select-sm ms-1 border-primary">
                                    <option value=" 09:00" selected>09:00 AM</option>
                                    <option value=" 10:00">10:00 AM</option>
                                    <option value=" 11:00">11:00 AM</option>
                                    <option value=" 12:00">12:00 PM</option>
                                    <option value=" 13:00">01:00 PM</option>
                                    <option value=" 14:00">02:00 PM</option>
                                    <option value=" 15:00">03:00 PM</option>
                                    <option value=" 16:00">04:00 PM</option>
                                    <option value=" 17:00">05:00 PM</option>
                                    <option value=" 18:00">06:00 PM</option>
                                    <option value=" 19:00">07:00 PM</option>
                                    <option value=" 20:00">08:00 PM</option>
                                    <option value=" 21:00">09:00 PM</option>
                                    <option value=" 22:00">10:00 PM</option>

                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <p class="text-primary fw-bold">Pickup and Return Location</p>
                        <div class="d-flex">
                            <div class=" col-md-11">
                                <input type="text" name="location" value="{{carsData.pick_up_address.address}}"
                                    class="form-control  border-primary" readonly />
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <div class=" col-md-11 d-grid">

                            <p class="text-danger" id="days-msg1"></p>


                            <p class="text-danger" id="car-booked-msg1"></p>

                            {{#if userNotVerified}}
                            <p class="text-danger">Please verify your account by uploading your licence <a
                                    href="/edit-profile">upload</a></p>

                            {{/if}}
                            <button type="submit" class="btn btn-primary">continue</button>
                        </div>
                    </div>
                </form>
                {{!-- <div class="mt-3">
                    <div class=" col-md-11 d-grid">
                        <button type="submit" class="btn btn-outline-primary btn-sm rounded-1">add to
                            favourites</button>
                    </div>
                </div> --}}


            </div>

        </div>
    </div>
</section>

<script>
    var todayDate = new Date();
    var month = todayDate.getMonth() + 1
    var year = todayDate.getUTCFullYear() - 0;
    var tdatefrom = todayDate.getDate()
    var tdateto = todayDate.getDate() + 1
    if (month < 10) {
        month = "0" + month
    }
    if (tdatefrom < 10) {
        tdatefrom = "0" + tdatefrom;
    }
    if (tdateto < 10) {
        tdateto = "0" + tdateto;
    }
    var maxDatefrom = year + "-" + month + "-" + tdatefrom;
    document.getElementById("from").setAttribute("value", maxDatefrom);
    document.getElementById("from").setAttribute("min", maxDatefrom);


    var maxDateto = year + "-" + month + "-" + tdateto;
    document.getElementById("to").setAttribute("value", maxDateto);
    document.getElementById("to").setAttribute("min", maxDateto);


    var maxDatefrom = year + "-" + month + "-" + tdatefrom;
    document.getElementById("from1").setAttribute("value", maxDatefrom);
    document.getElementById("from1").setAttribute("min", maxDatefrom);

    var maxDateto = year + "-" + month + "-" + tdateto;
    document.getElementById("to1").setAttribute("value", maxDateto);
    document.getElementById("to1").setAttribute("min", maxDateto);


//======================mobile form ====================================================


    function fromDateSelect() {
        let fromDate = document.getElementById('from').value
        var date = new Date(fromDate);

        var month = date.getMonth() + 1
        var year = date.getUTCFullYear() - 0;
        var tdatefrom = date.getDate() + 1
        if (month < 10) {
            month = "0" + month
        }
        if (tdatefrom < 10) {
            tdatefrom = "0" + tdatefrom;
        }

      
        var maxDatefrom = year + "-" + month + "-" + tdatefrom;
        document.getElementById("to").setAttribute("value", maxDatefrom);
        document.getElementById("to").setAttribute("min", maxDatefrom);


        checkCarBooked('{{carsData._id}}')


    }

      function checkCarBooked(carId) {
        console.log(carId)
        let fromDate = document.getElementById("from").value
        let fromTime = document.getElementById("from-time").value
        let toDate = document.getElementById("to").value
        let toTime = document.getElementById("to-time").value

        console.log(fromDate, toDate, fromTime, toTime)
        let from = new Date(fromDate + fromTime)
        let to = new Date(toDate + toTime)
        console.log(from, to)
        fetch('/check-car-available/' + carId + '/' + from + '/' + to)
            .then((response) => response.json())
            .then((data) => {
                
                if (data) {

                    document.getElementById("car-booked-msg").innerHTML = "This car is booked for the date you have selected plese choose some other dates"

                } else {

                    document.getElementById("car-booked-msg").innerHTML = ""

                }


            })
    }

    checkCarBooked('{{carsData._id}}')



    function checkTime(carId) {

        let fromDate = document.getElementById("from").value
        let fromTime = document.getElementById("from-time").value
        let toDate = document.getElementById("to").value
        let toTime = document.getElementById("to-time").value
        let bookedMsg = document.getElementById("car-booked-msg").textContent


        let from = new Date(fromDate + fromTime)
        let to = new Date(toDate + toTime)

        let hours = Math.abs(to - from) / 36e5


        if (from < new Date()) {
            document.getElementById("time-err-msg").innerHTML = "Invalid time"
            return false;
        }
        if (hours < 24 || hours > 240) {
            document.getElementById("days-msg").classList.remove("d-none")
            document.getElementById("days-msg").classList.add("d-block")
            return false;
        } else {
            document.getElementById("days-msg").classList.remove("d-block")
            document.getElementById("days-msg").classList.add("d-none")
        }
        checkCarBooked(carId)
        if (bookedMsg != "") {
            console.log(bookedMsg)
            return false;
        }


    }



    //================================desk top form =======================================================

    function fromDateSelect1() {
        let fromDate1 = document.getElementById('from1').value
        var date1 = new Date(fromDate1);

        

        var month1 = date1.getMonth() + 1
        var year1 = date1.getUTCFullYear() - 0;
        var tdatefrom1 = date1.getDate() + 1
        if (month1 < 10) {
            month1 = "0" + month1
        }
        if (tdatefrom1 < 10) {
            tdatefrom1 = "0" + tdatefrom1;
        }
        

        var maxDatefrom1 = year1 + "-" + month1 + "-" + tdatefrom1;
        document.getElementById("to1").setAttribute("value", maxDatefrom1);
        document.getElementById("to1").setAttribute("min", maxDatefrom1);


        checkCarBooked1('{{carsData._id}}')


    }



    function checkCarBooked1(carId) {
      //  console.log(carId)
        let fromDate = document.getElementById("from1").value
        let fromTime = document.getElementById("from-time1").value
        let toDate = document.getElementById("to1").value
        let toTime = document.getElementById("to-time1").value

       // console.log(fromDate, toDate, fromTime, toTime)
        let from = new Date(fromDate + fromTime)
        let to = new Date(toDate + toTime)
        
        fetch('/check-car-available/' + carId + '/' + from + '/' + to)
            .then((response) => response.json())
            .then((data) => {
                
                if (data) {

                    document.getElementById("car-booked-msg1").innerHTML = "This car is booked for the date you have selected plese choose some other dates"

                } else {

                    document.getElementById("car-booked-msg1").innerHTML = ""

                }


            })
    }

    checkCarBooked1('{{carsData._id}}')



    function checkTime1(carId) {

        let fromDate = document.getElementById("from1").value
        let fromTime = document.getElementById("from-time1").value
        let toDate = document.getElementById("to1").value
        let toTime = document.getElementById("to-time1").value
        let bookedMsg = document.getElementById("car-booked-msg1").textContent

        let from = new Date(fromDate + fromTime)
        let to = new Date(toDate + toTime)

        let hours = Math.abs(to - from) / 36e5
        console.log(hours)

        if (from < new Date()) {
            document.getElementById("time-err-msg1").innerHTML = "Invalid time"
            return false;
        } else {
            document.getElementById("time-err-msg1").innerHTML = ""

        }

        if (hours < 24 || hours > 240) {
            document.getElementById("days-msg1").innerHTML = "Select days between <b> 1 </b> to <b> 10 </b> days"
            return false;
        } else {
            document.getElementById("days-msg1").innerHTML = ""

        }
        checkCarBooked1(carId)
        if (bookedMsg != "") {
            console.log(bookedMsg)
            return false;
        }


    }

    




    const ratingStars = [...document.getElementsByClassName("star-rating")];
    for (i = 0; i < ratingStars.length; i++) {
        rating = ratingStars[i].children[0].innerHTML
        for (j = 1; j <= rating; j++) {
            ratingStars[i].children[j].classList.add("fas")
            ratingStars[i].children[j].classList.remove("far")
        }
    }

</script>